
 <!DOCTYPE html>
 <html lang="en">
 <head>
     <meta charset="UTF-8">
     <meta name="viewport" content="width=device-width, initial-scale=1.0">
     <title>Stock Portfolio Report</title>
     <style>
         body { font-family: Arial, sans-serif; margin: 20px; }
         h1, h2 { color: #333; }
         .datetime { font-size: 0.6em; color: #666; font-weight: normal; }
         .summary { background-color: #f5f5f5; padding: 15px; border-radius: 5px; margin-bottom: 20px; }
         table { border-collapse: collapse; width: 100%; margin-bottom: 20px; }
         th, td { border: 1px solid #ddd; padding: 8px; text-align: left; }
         th { background-color: #f2f2f2; }
         tr:nth-child(even) { background-color: #f9f9f9; }
         .chart-container { margin: 20px 0; text-align: center; }
         .gain { color: green; }
         .loss { color: red; }
     </style>
 </head>
 <body>
     <h1>Stock Portfolio Report created on {{ current_datetime }}<span class="datetime"></span></h1>
 
     <div class="summary">
         <h2>Portfolio Summary</h2>
        <p><strong>Total Investment:</strong> {{ total_investment }}</p>
        <p><strong>Total Current Value:</strong> {{ total_current }}</p>
        <p><strong>Total Gain/Loss:</strong> 
            <span class="{% if total_gain_loss.amount >= 0 %}gain{% else %}loss{% endif %}">
                {{ total_gain_loss }}
            </span>
        </p>
        <p><strong>Total Gain/Loss %:</strong> 
            <span class="{% if total_gain_loss_pct >= 0 %}gain{% else %}loss{% endif %}">
                {{ "%.2f"|format(total_gain_loss_pct) }}%
            </span>
        </p>
        <p><strong>Dollars Per Day Gain/Loss:</strong>
            <span class="{% if total_dollars_per_day >= 0 %}gain{% else %}loss{% endif %}">
                ${{ "%.2f"|format(total_dollars_per_day) }}
            </span>
    </div>

    <h2>Individual Stock Holdings</h2>
    <table id="holdings">
        <thead>
            <tr>
                <th onclick="sortTable('holdings',0)">Name</th>
                <th onclick="sortTable('holdings',1)">Symbol</th>
                <th onclick="sortTable('holdings',2)">Purchase Price</th>
                <th onclick="sortTable('holdings',3)">Current Price</th>
                <th onclick="sortTable('holdings',4)">Quantity</th>
                <th onclick="sortTable('holdings',5)">Gain/Loss</th>
                <th onclick="sortTable('holdings',6)">Gain/Loss %</th>
                <th onclick="sortTable('holdings',7)">Days Held</th>
                <th onclick="sortTable('holdings',8)">Dollars per day</th>
                <th onclick="sortTable('holdings',9)">10 day average price</th>
                <th onclick="sortTable('holdings',10)">30 day average price</th>
                <th onclick="sortTable('holdings',11)">50 day average price</th>
                <th onclick="sortTable('holdings',12)">100 day average price</th>
                <th onclick="sortTable('holdings',13)">200 day average price</th>
                <th onclick="sortTable('holdings',14)">Today's Change</th>
                <th onclick="sortTable('holdings',15)">5 Day Return</th>
                <th onclick="sortTable('holdings',16)">30 day Return</th>
                <th onclick="sortTable('holdings',17)">90 Day Return</th>
                <th onclick="sortTable('holdings',18)">YTD Return</th>
                <th onclick="sortTable('holdings',19)">1 Year Return</th>
            </tr>
        </thead>
        <tbody>
            {% for stock in stock_details %}
            <tr>
                <td>{{ stock.name }}</td>
                <td>{{ stock.symbol }}</td>
                <td>${{ "%.2f"|format(stock.purchase_price) }}</td>
                <td>
                    {% if stock.current_price != "N/A" %}
                        ${{ "%.2f"|format(stock.current_price) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>{{ stock.quantity }}</td>
                <td class="{% if stock.gain_loss != "N/A" %}{% if stock.gain_loss >= 0 %}gain{% else %}loss{% endif %}{% endif %}">
                    {% if stock.gain_loss != "N/A" %}
                        ${{ "%.2f"|format(stock.gain_loss) }}

                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td class="{% if stock.gain_loss != "N/A" %}{% if stock.gain_loss >= 0 %}gain{% else %}loss{% endif %}{% endif %}">
                    {% if stock.gain_loss_pct != "N/A" %}
                        {{ "%.2f"|format(stock.gain_loss_pct) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.days_held != "N/A" %}
                        {{ stock.days_held }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.dollars_per_day != "N/A" %}
                        ${{ "%.2f"|format(stock.dollars_per_day) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.ten_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.ten_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.thirty_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.thirty_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.fifty_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.fifty_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.one_hundred_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.one_hundred_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.two_hundred_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.two_hundred_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.percent_change_today != "N/A" %}
                        {{ "%.2f"|format(stock.percent_change_today) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.five_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.five_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.thirty_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.thirty_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.ninety_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.ninety_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.ytd_return != "N/A" %}
                        {{ "%.2f"|format(stock.ytd_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.one_year_return != "N/A" %}
                        {{ "%.2f"|format(stock.one_year_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

    <div class="chart-container">
        <h2>Portfolio Visualization</h2>
        <img src="data:image/png;base64,{{ chart_img }}" alt="Portfolio Charts">
    </div>

    <h2>Watchlist</h2>
    <table id="watchlist">
        <thead>
            <tr>
                <th onclick="sortTable('watchlist',0)">Name</th>
                <th onclick="sortTable('watchlist',1)">Symbol</th>
                <th onclick="sortTable('watchlist',2)">Current Price</th>
                <th onclick="sortTable('watchlist',3)">10 day average price</th>
                <th onclick="sortTable('watchlist',4)">30 day average price</th>
                <th onclick="sortTable('watchlist',5)">50 day average price</th>
                <th onclick="sortTable('watchlist',6)">100 day average price</th>
                <th onclick="sortTable('watchlist',7)">200 day average price</th>
                <th onclick="sortTable('watchlist',8)">Today's Change</th>
                <th onclick="sortTable('watchlist',9)">5 Day Return</th>
                <th onclick="sortTable('watchlist',10)">30 day Return</th>
                <th onclick="sortTable('watchlist',11)">90 Day Return</th>
                <th onclick="sortTable('watchlist',12)">YTD Return</th>
                <th onclick="sortTable('watchlist',13)">1 Year Return</th>
            </tr>
        </thead>
        <tbody>
            {% for stock in watchlist_details %}
            <tr>
                <td>{{ stock.name }}</td>
                <td>{{ stock.symbol }}</td>
                <td>
                    {% if stock.current_price != "N/A" %}
                        ${{ "%.2f"|format(stock.current_price) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>

                <td>
                    {% if stock.ten_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.ten_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.thirty_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.thirty_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.fifty_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.fifty_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.one_hundred_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.one_hundred_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.two_hundred_day_moving_average != "N/A" %}
                        ${{ "%.2f"|format(stock.two_hundred_day_moving_average) }}
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.percent_change_today != "N/A" %}
                        {{ "%.2f"|format(stock.percent_change_today) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.five_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.five_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.thirty_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.thirty_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.ninety_day_return != "N/A" %}
                        {{ "%.2f"|format(stock.ninety_day_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.ytd_return != "N/A" %}
                        {{ "%.2f"|format(stock.ytd_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
                <td>
                    {% if stock.one_year_return != "N/A" %}
                        {{ "%.2f"|format(stock.one_year_return) }}%
                    {% else %}
                        N/A
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>

<script>
function sortTable(table_id, column_number) {
  var table, rows, switching, i, x, y, shouldSwitch, dir, switchcount = 0;
  table = document.getElementById(table_id);
  switching = true;
  // Set the sorting direction to ascending:
  dir = "asc";
  /* Make a loop that will continue until
  no switching has been done: */
  while (switching) {
    // Start by saying: no switching is done:
    switching = false;
    rows = table.rows;
    /* Loop through all table rows (except the
    first, which contains table headers): */
    for (i = 1; i < (rows.length - 1); i++) {
      // Start by saying there should be no switching:
      shouldSwitch = false;
      /* Get the two elements you want to compare,
      one from current row and one from the next: */
      x = rows[i].getElementsByTagName("TD")[column_number];
      y = rows[i + 1].getElementsByTagName("TD")[column_number];
      /* Check if the two rows should switch place,
      based on the direction, asc or desc: */
      if (dir == "asc") {
        if (x.innerHTML.toLowerCase() > y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      } else if (dir == "desc") {
        if (x.innerHTML.toLowerCase() < y.innerHTML.toLowerCase()) {
          // If so, mark as a switch and break the loop:
          shouldSwitch = true;
          break;
        }
      }
    }
    if (shouldSwitch) {
      /* If a switch has been marked, make the switch
      and mark that a switch has been done: */
      rows[i].parentNode.insertBefore(rows[i + 1], rows[i]);
      switching = true;
      // Each time a switch is done, increase this count by 1:
      switchcount ++;
    } else {
      /* If no switching has been done AND the direction is "asc",
      set the direction to "desc" and run the while loop again. */
      if (switchcount == 0 && dir == "asc") {
        dir = "desc";
        switching = true;
      }
    }
  }
}
</script>

</body>
</html>
